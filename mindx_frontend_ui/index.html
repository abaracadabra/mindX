<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>mindX Control Panel</title>
    <link rel="stylesheet" href="styles3.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-left">
                <h1>mindX Control Panel</h1>
                <div class="github-link">
                    <a href="https://github.com/abaracadabra/mindX" target="_blank" rel="noopener noreferrer">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                        </svg>
                        <span>GitHub</span>
                    </a>
                </div>
            </div>
            <div class="header-right">
                <div class="autonomous-control">
                    <label class="autonomous-toggle">
                        <input type="checkbox" id="autonomous-mode">
                        <span class="toggle-slider"></span>
                        <span class="toggle-label">AUTONOMOUS</span>
                    </label>
                </div>
            <div id="status-light" class="status-light-red" title="Disconnected"></div>
            </div>
        </header>

            <!-- Tab Navigation -->
            <nav class="tab-navigation">
                <div class="tab-row">
                    <button class="tab-btn active" data-tab="control">Control</button>
                    <button class="tab-btn" data-tab="agents">Agents</button>
                    <button class="tab-btn" data-tab="system">System</button>
                    <button class="tab-btn" data-tab="logs">Logs</button>
                    <button class="tab-btn" data-tab="admin">Admin</button>
                </div>
                <div class="tab-row core-tabs">
                    <div class="core-tabs-label">Core Components</div>
                    <button class="tab-btn core-tab" data-tab="core">Core Systems</button>
                    <button class="tab-btn core-tab" data-tab="evolution">Evolution</button>
                    <button class="tab-btn core-tab" data-tab="learning">Learning</button>
                    <button class="tab-btn core-tab" data-tab="orchestration">Orchestration</button>
                </div>
            </nav>

        <!-- Control Tab -->
        <div id="control-tab" class="tab-content active">
            <div class="control-section">
                <div class="section-header">
                    <div class="section-tabs">
                        <button class="section-tab active" data-section="evolve">Evolve Codebase</button>
                        <button class="section-tab" data-section="query">Query Coordinator</button>
                    </div>
                </div>
                
                <!-- Evolve Codebase Section -->
                <div id="evolve-section" class="section-content active">
                    <textarea id="evolve-directive" placeholder="Enter a high-level directive for evolution..."></textarea>
                    <div class="evolve-controls">
                        <button id="evolve-btn" class="evolve-action-btn">mindX</button>
                        <div class="cycle-control">
                            <label for="cycle-count">Max Cycles:</label>
                            <input type="number" id="cycle-count" value="8" min="1" max="100">
                        </div>
                        <div class="autonomous-control">
                            <label class="autonomous-toggle">
                                <input type="checkbox" id="evolve-autonomous-mode">
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">Autonomous Mode</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Query Coordinator Section -->
                <div id="query-section" class="section-content">
                    <input type="text" id="query-input" placeholder="explain augmentic development">
                    <button id="query-btn">Send Query</button>
                </div>
            </div>
            <div class="control-section">
                <h2>Simple Coder Update Requests</h2>
                <div class="update-request-controls">
                <button id="refresh-updates-btn">Refresh Updates</button>
                <button id="select-all-btn" disabled style="font-size: 12px; padding: 6px 12px;">Select All</button>
                <button id="approve-all-btn" disabled>Approve All</button>
                <button id="delete-all-btn" disabled>Delete All Selected</button>
                </div>
                <div id="update-requests-container">
                    <p>No pending update requests</p>
                </div>
                
                <script>
                // Global variables for selection
                let allUpdateRequests = [];
                let selectedRequests = new Set();
                
            // Simple inline script to load updates immediately
            function loadUpdatesInline() {
                console.log('Loading updates inline...');
                console.log('Current selected requests before load:', Array.from(selectedRequests));
                const container = document.getElementById('update-requests-container');
                const selectAllBtn = document.getElementById('select-all-btn');
                const approveAllBtn = document.getElementById('approve-all-btn');
                const deleteAllBtn = document.getElementById('delete-all-btn');
                    
                    fetch('http://localhost:8000/simple-coder/update-requests')
                        .then(response => response.json())
                        .then(data => {
                            console.log('Data received:', data);
                            console.log('Previous allUpdateRequests count:', allUpdateRequests.length);
                            console.log('Data type:', typeof data, 'Is array:', Array.isArray(data));
                            console.log('Data length:', data ? data.length : 'null/undefined');
                            allUpdateRequests = data;
                            console.log('New allUpdateRequests count:', allUpdateRequests.length);
                            console.log('Clearing selectedRequests, previous count:', selectedRequests.size);
                            selectedRequests.clear();
                            console.log('SelectedRequests cleared, new count:', selectedRequests.size);
                            
                            // Always clear the container first
                                container.innerHTML = '';
                            
                            if (data && data.length > 0) {
                                data.forEach((request, index) => {
                                    const div = document.createElement('div');
                                    div.className = 'update-request';
                                    div.style.margin = '10px 0';
                                    div.style.padding = '15px';
                                    div.style.border = '1px solid #555';
                                    div.style.borderRadius = '8px';
                                    div.style.background = '#1a1a1a';
                                    div.style.color = '#fff';
                                    div.setAttribute('data-request-id', request.request_id);
                                    
                                    div.innerHTML = `
                                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                                            <input type="checkbox" class="update-checkbox" data-request-id="${request.request_id}" style="margin-right: 10px; transform: scale(1.2);">
                                            <h4 style="margin: 0; flex: 1;">Update Request ${index + 1}: ${request.request_id}</h4>
                                            <span style="background: #ffaa00; color: #000; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; font-weight: bold;">${request.status}</span>
                                        </div>
                                        <p><strong>Original File:</strong> ${request.original_file}</p>
                                        <p><strong>Sandbox File:</strong> ${request.sandbox_file}</p>
                                        <p><strong>Cycle:</strong> ${request.cycle}</p>
                                        <p><strong>Changes:</strong> ${request.changes.length} modifications</p>
                                        <p><strong>Timestamp:</strong> ${new Date(request.timestamp).toLocaleString()}</p>
                                        <div style="margin-top: 10px;">
                                            <button onclick="approveUpdate('${request.request_id}')" style="margin: 5px; padding: 5px 10px; background: #00aa00; color: white; border: none; border-radius: 3px; cursor: pointer;">Approve</button>
                                            <button onclick="rejectUpdate('${request.request_id}')" style="margin: 5px; padding: 5px 10px; background: #aa0000; color: white; border: none; border-radius: 3px; cursor: pointer;">Reject</button>
                                        </div>
                                    `;
                                    container.appendChild(div);
                                });
                                
                                // Enable control buttons
                                if (selectAllBtn) selectAllBtn.disabled = false;
                                if (approveAllBtn) approveAllBtn.disabled = false;
                                if (deleteAllBtn) deleteAllBtn.disabled = false;
                                
                                // Add event listeners
                                setupSelectionHandlers();
                                
                                console.log(`Displayed ${data.length} update requests`);
                            } else {
                                // Show message when no requests
                                container.innerHTML = '<p style="color: #888; text-align: center; padding: 20px;">No pending update requests</p>';
                                
                                // Disable control buttons
                                if (selectAllBtn) selectAllBtn.disabled = true;
                                if (approveAllBtn) approveAllBtn.disabled = true;
                                if (deleteAllBtn) deleteAllBtn.disabled = true;
                                
                                console.log('No update requests to display');
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            container.innerHTML = `<p style="color: #ff6666;">Error: ${error.message}</p>`;
                        });
                }
                
                // Setup selection handlers
                function setupSelectionHandlers() {
                // Checkbox change handlers
                document.querySelectorAll('.update-checkbox').forEach(checkbox => {
                    // Remove any existing event listeners
                    checkbox.replaceWith(checkbox.cloneNode(true));
                });
                
                // Re-add event listeners to all checkboxes
                document.querySelectorAll('.update-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', function() {
                        const requestId = this.getAttribute('data-request-id');
                        console.log('Checkbox changed:', requestId, 'checked:', this.checked);
                        if (this.checked) {
                            selectedRequests.add(requestId);
                            this.closest('.update-request').style.border = '2px solid #00ff00';
                        } else {
                            selectedRequests.delete(requestId);
                            this.closest('.update-request').style.border = '1px solid #555';
                        }
                        console.log('Selected requests after change:', selectedRequests.size);
                        updateButtonStates();
                    });
                });
                    
                // Select All button
                const selectAllBtn = document.getElementById('select-all-btn');
                if (selectAllBtn) {
                    // Remove any existing event listeners
                    selectAllBtn.replaceWith(selectAllBtn.cloneNode(true));
                    const newSelectAllBtn = document.getElementById('select-all-btn');
                    
                    newSelectAllBtn.addEventListener('click', function() {
                        console.log('Select All clicked, current selected:', selectedRequests.size, 'total:', allUpdateRequests.length);
                        const allChecked = selectedRequests.size === allUpdateRequests.length;
                        console.log('All checked:', allChecked);
                        
                        // Toggle all checkboxes
                        document.querySelectorAll('.update-checkbox').forEach(checkbox => {
                            const requestId = checkbox.getAttribute('data-request-id');
                            
                            if (allChecked) {
                                // Deselect all - uncheck all boxes
                                checkbox.checked = false;
                                selectedRequests.delete(requestId);
                                checkbox.closest('.update-request').style.border = '1px solid #555';
                            } else {
                                // Select all - check all boxes
                                checkbox.checked = true;
                                selectedRequests.add(requestId);
                                checkbox.closest('.update-request').style.border = '2px solid #00ff00';
                            }
                        });
                        console.log('After select all, selected:', selectedRequests.size);
                        updateButtonStates();
                    });
                }
                    
                    // Delete All Selected button
                    const deleteAllBtn = document.getElementById('delete-all-btn');
                    if (deleteAllBtn) {
                        // Remove any existing event listeners
                        deleteAllBtn.replaceWith(deleteAllBtn.cloneNode(true));
                        const newDeleteAllBtn = document.getElementById('delete-all-btn');
                        
                        newDeleteAllBtn.addEventListener('click', function() {
                            console.log('Delete All Selected button clicked!');
                            console.log('Selected requests:', Array.from(selectedRequests));
                            if (selectedRequests.size === 0) {
                                alert('No requests selected');
                                return;
                            }
                            
                        if (confirm(`Delete ${selectedRequests.size} selected requests?`)) {
                            const requestsToDelete = Array.from(selectedRequests);
                            let completed = 0;
                            
                            console.log('Starting bulk delete of', requestsToDelete.length, 'requests');
                            console.log('Requests to delete:', requestsToDelete);
                            
                            requestsToDelete.forEach(requestId => {
                                console.log('Deleting request:', requestId);
                                fetch(`http://localhost:8000/simple-coder/reject-update/${requestId}`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Accept': 'application/json'
                                    }
                                })
                                .then(response => {
                                    console.log('Delete response for', requestId, ':', response.status, response.statusText);
                                    console.log('Response headers for', requestId, ':', Object.fromEntries(response.headers.entries()));
                                    if (response.ok) {
                                        return response.json();
                                    } else {
                                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                    }
                                })
                                .then(data => {
                                    console.log('Delete success for', requestId, ':', data);
                                })
                                .catch(error => {
                                    console.error('Error deleting request:', requestId, error);
                                })
                                .finally(() => {
                                    completed++;
                                    console.log(`Completed ${completed}/${requestsToDelete.length} deletions`);
                                    if (completed === requestsToDelete.length) {
                                        console.log('Bulk delete completed, auto-refreshing...');
                                        selectedRequests.clear();
                                        // Reset button states immediately
                                        updateButtonStates();
                                        // Auto-refresh after 2 seconds
                                        setTimeout(() => {
                                            console.log('Executing bulk delete auto-refresh...');
                                            autoRefresh();
                                        }, 2000);
                                    }
                                });
                                });
                            }
                        });
                    }
                    
                    // Approve All button
                    const approveAllBtn = document.getElementById('approve-all-btn');
                    if (approveAllBtn) {
                        approveAllBtn.addEventListener('click', function() {
                            if (selectedRequests.size === 0) {
                                alert('No requests selected');
                                return;
                            }
                            
                            if (confirm(`Approve ${selectedRequests.size} selected requests?`)) {
                                const requestsToApprove = Array.from(selectedRequests);
                                let completed = 0;
                                
                                console.log('Starting bulk approve of', requestsToApprove.length, 'requests');
                                
                                requestsToApprove.forEach(requestId => {
                                    fetch(`http://localhost:8000/simple-coder/approve-update/${requestId}`, {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        }
                                    })
                                    .then(response => {
                                        if (response.ok) {
                                            console.log('Approved request:', requestId);
                                        } else {
                                            console.error('Failed to approve request:', requestId, response.status);
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error approving request:', requestId, error);
                                    })
                                .finally(() => {
                                    completed++;
                                    if (completed === requestsToApprove.length) {
                                        console.log('Bulk approve completed, auto-refreshing...');
                                        selectedRequests.clear();
                                        // Reset button states immediately
                                        updateButtonStates();
                                        // Auto-refresh after 2 seconds
                                        setTimeout(autoRefresh, 2000);
                                    }
                                });
                                });
                            }
                        });
                    }
                }
                
                // Update button states
                function updateButtonStates() {
                    const selectAllBtn = document.getElementById('select-all-btn');
                    const deleteAllBtn = document.getElementById('delete-all-btn');
                    const approveAllBtn = document.getElementById('approve-all-btn');
                    
                    if (selectAllBtn) {
                        if (allUpdateRequests.length === 0) {
                            selectAllBtn.textContent = 'Select All';
                            selectAllBtn.disabled = true;
                        } else {
                            selectAllBtn.disabled = false;
                        selectAllBtn.textContent = selectedRequests.size === allUpdateRequests.length ? 'Deselect All' : 'Select All';
                        }
                    }
                    
                    if (deleteAllBtn) {
                        deleteAllBtn.disabled = selectedRequests.size === 0;
                        deleteAllBtn.textContent = `Delete All Selected (${selectedRequests.size})`;
                    }
                    
                    if (approveAllBtn) {
                        approveAllBtn.disabled = selectedRequests.size === 0;
                        approveAllBtn.textContent = `Approve All Selected (${selectedRequests.size})`;
                    }
                }
                
            // Make functions globally accessible
            window.approveUpdate = function(requestId) {
                console.log('Approving individual request:', requestId);
                fetch(`http://localhost:8000/simple-coder/approve-update/${requestId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    console.log('Individual approve response:', response.status, response.statusText);
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .then(data => {
                    console.log('Individual approve success:', data);
                    selectedRequests.delete(requestId);
                    // Reset button states immediately
                    updateButtonStates();
                    // Auto-refresh after 2 seconds
                    setTimeout(autoRefresh, 2000);
                })
                .catch(error => {
                    console.error('Error approving individual request:', error);
                    alert('Error approving request: ' + error.message);
                });
            };
                
            window.rejectUpdate = function(requestId) {
                console.log('Rejecting individual request:', requestId);
                console.log('Current selected requests before reject:', Array.from(selectedRequests));
                
                fetch(`http://localhost:8000/simple-coder/reject-update/${requestId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    console.log('Individual reject response:', response.status, response.statusText);
                    console.log('Response headers:', Object.fromEntries(response.headers.entries()));
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                })
                .then(data => {
                    console.log('Individual reject success:', data);
                    selectedRequests.delete(requestId);
                    console.log('Selected requests after reject:', Array.from(selectedRequests));
                    // Reset button states immediately
                    updateButtonStates();
                    // Auto-refresh after 2 seconds
                    console.log('Scheduling auto-refresh in 2 seconds...');
                    setTimeout(() => {
                        console.log('Executing auto-refresh...');
                        autoRefresh();
                    }, 2000);
                })
                .catch(error => {
                    console.error('Error rejecting individual request:', error);
                    alert('Error rejecting request: ' + error.message);
                });
            };
                
                
            // Auto-refresh function
            function autoRefresh() {
                console.log('Auto-refreshing updates...');
                console.log('Current selected requests before auto-refresh:', Array.from(selectedRequests));
                loadUpdatesInline();
            }
            
            // Test function to verify functions are accessible
            window.testFunctions = function() {
                console.log('Testing functions...');
                console.log('approveUpdate function:', typeof window.approveUpdate);
                console.log('rejectUpdate function:', typeof window.rejectUpdate);
                console.log('autoRefresh function:', typeof autoRefresh);
            };
            
            
            
            // Auto-refresh polling mechanism
            let refreshInterval = null;
            let lastRequestCount = 0;
            let lastCycleCount = 0;
            let lastTotalUpdates = 0;
            
            function startAutoRefresh() {
                // Clear any existing interval
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                }
                
                // Poll every 3 seconds for changes
                refreshInterval = setInterval(async () => {
                    try {
                        // Check both update requests and status
                        const [requestsResponse, statusResponse] = await Promise.all([
                            fetch('http://localhost:8000/simple-coder/update-requests'),
                            fetch('http://localhost:8000/simple-coder/status')
                        ]);
                        
                        const requestsData = await requestsResponse.json();
                        const statusData = await statusResponse.json();
                        
                        // Check if the number of requests has changed
                        if (requestsData && requestsData.length !== lastRequestCount) {
                            console.log(`Update request count changed: ${lastRequestCount} -> ${requestsData.length}`);
                            lastRequestCount = requestsData.length;
                            
                            // Show notification for new requests
                            showBuildNotification(`New update requests detected: ${requestsData.length} pending`);
                            
                            // Refresh the UI to show new requests
                            loadUpdatesInline();
                        }
                        
                        // Check if cycle count or total updates have increased (indicating build completion)
                        const currentCycleCount = statusData?.cycle_count || 0;
                        const currentTotalUpdates = statusData?.total_updates || 0;
                        
                        if (currentCycleCount > lastCycleCount || currentTotalUpdates > lastTotalUpdates) {
                            console.log(`Build progress detected - cycles: ${lastCycleCount} -> ${currentCycleCount}, updates: ${lastTotalUpdates} -> ${currentTotalUpdates}`);
                            
                            // Update tracking variables
                            lastCycleCount = currentCycleCount;
                            lastTotalUpdates = currentTotalUpdates;
                            
                            // Show notification for build completion only if there are new updates
                            if (currentTotalUpdates > lastTotalUpdates) {
                                showBuildNotification('Build completed - checking for new requests...');
                            }
                            
                            // Refresh the UI to show any new requests from completed builds
                            loadUpdatesInline();
                        }
                    } catch (error) {
                        console.error('Auto-refresh polling error:', error);
                    }
                }, 3000); // Poll every 3 seconds
                
                console.log('Auto-refresh polling started');
            }
            
            function stopAutoRefresh() {
                if (refreshInterval) {
                    clearInterval(refreshInterval);
                    refreshInterval = null;
                    console.log('Auto-refresh polling stopped');
                }
            }
            
            // Show build notification
            function showBuildNotification(message) {
                // Create notification element
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #0066cc;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 6px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 10000;
                    font-size: 14px;
                    font-weight: 500;
                    max-width: 300px;
                    animation: slideIn 0.3s ease-out;
                `;
                notification.textContent = message;
                
                // Add animation keyframes
                if (!document.getElementById('notification-styles')) {
                    const style = document.createElement('style');
                    style.id = 'notification-styles';
                    style.textContent = `
                        @keyframes slideIn {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        @keyframes slideOut {
                            from { transform: translateX(0); opacity: 1; }
                            to { transform: translateX(100%); opacity: 0; }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Add to page
                document.body.appendChild(notification);
                
                // Auto-remove after 4 seconds
                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 4000);
            }
            
            // Load updates when page loads
            window.addEventListener('load', function() {
                console.log('Page loaded, loading updates...');
                setTimeout(loadUpdatesInline, 1000);
                
                // Initialize tracking variables
                setTimeout(async () => {
                    try {
                        const statusResponse = await fetch('http://localhost:8000/simple-coder/status');
                        const statusData = await statusResponse.json();
                        lastCycleCount = statusData?.cycle_count || 0;
                        lastTotalUpdates = statusData?.total_updates || 0;
                        console.log('Initialized tracking - cycles:', lastCycleCount, 'updates:', lastTotalUpdates);
                    } catch (error) {
                        console.error('Failed to initialize tracking variables:', error);
                    }
                }, 2000);
                
                // Start auto-refresh polling
                startAutoRefresh();
                
                // Set up refresh button
                const refreshBtn = document.getElementById('refresh-updates-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', function() {
                        console.log('Refresh button clicked');
                        this.disabled = true;
                        this.textContent = 'Refreshing...';
                        loadUpdatesInline();
                        setTimeout(() => {
                            this.disabled = false;
                            this.textContent = 'Refresh Updates';
                        }, 2000);
                    });
                }
                
            });
            
            // Stop auto-refresh when page is unloaded
            window.addEventListener('beforeunload', function() {
                stopAutoRefresh();
            });
                </script>
            </div>
            
        </div>

        <!-- Core Systems Tab -->
        <div id="core-tab" class="tab-content">
            <div class="control-section">
                <h2>BDI Agent Status</h2>
                <div id="bdi-status" class="system-status">
                    <div class="status-grid">
                        <div class="status-item">
                            <span class="status-label">BDI Agent:</span>
                            <span id="bdi-agent-status" class="status-value">Loading...</span>
                            <div id="bdi-status-indicator" class="status-indicator"></div>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Last Action:</span>
                            <span id="bdi-last-action" class="status-value">None</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Active Goals:</span>
                            <span id="bdi-goal-count" class="status-value">0</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Belief Count:</span>
                            <span id="belief-count" class="status-value">Loading...</span>
                        </div>
                    </div>
                    <div class="goals-section">
                        <h3>Current Goals</h3>
                        <div id="bdi-goals" class="goals-list"></div>
                    </div>
                    <div class="plans-section">
                        <h3>Active Plans</h3>
                        <div id="bdi-plans" class="plans-list"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Belief System</h2>
                <div id="belief-system" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Recent Beliefs:</span>
                        <div id="recent-beliefs" class="beliefs-list"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>ID Manager</h2>
                <div id="id-manager" class="system-status">
                    <div class="status-item">
                        <span class="status-label">ID Manager Status:</span>
                        <span id="id-manager-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Active Identities:</span>
                        <div id="active-identities" class="identities-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Evolution Tab -->
        <div id="evolution-tab" class="tab-content">
            <div class="control-section">
                <h2>Blueprint Agent</h2>
                <div id="blueprint-agent" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Blueprint Agent Status:</span>
                        <span id="blueprint-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Current Blueprint:</span>
                        <div id="current-blueprint" class="blueprint-content"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Action Converter</h2>
                <div id="action-converter" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Converter Status:</span>
                        <span id="converter-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Recent Conversions:</span>
                        <div id="recent-conversions" class="conversions-list"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Evolution Controls</h2>
                <div class="evolution-controls">
                    <button id="generate-blueprint-btn">Generate New Blueprint</button>
                    <button id="execute-evolution-btn">Execute Evolution</button>
                    <button id="analyze-system-btn">Analyze System</button>
                </div>
            </div>
        </div>

        <!-- Learning Tab -->
        <div id="learning-tab" class="tab-content">
            <div class="control-section">
                <h2>Strategic Evolution Agent</h2>
                <div id="strategic-evolution" class="system-status">
                    <div class="status-item">
                        <span class="status-label">SEA Status:</span>
                        <span id="sea-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Learning Progress:</span>
                        <div id="learning-progress" class="progress-bar"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Goal Management</h2>
                <div id="goal-management" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Active Goals:</span>
                        <div id="active-goals" class="goals-list"></div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Completed Goals:</span>
                        <div id="completed-goals" class="goals-list"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Plan Management</h2>
                <div id="plan-management" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Current Plans:</span>
                        <div id="current-plans" class="plans-list"></div>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Plan Execution Status:</span>
                        <div id="plan-execution" class="execution-status"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Orchestration Tab -->
        <div id="orchestration-tab" class="tab-content">
            <div class="control-section">
                <h2>Mastermind Agent</h2>
                <div id="mastermind-agent" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Mastermind Status:</span>
                        <span id="mastermind-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Current Campaign:</span>
                        <div id="current-campaign" class="campaign-info"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>Coordinator Agent</h2>
                <div id="coordinator-agent" class="system-status">
                    <div class="status-item">
                        <span class="status-label">Coordinator Status:</span>
                        <span id="coordinator-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Active Interactions:</span>
                        <div id="active-interactions" class="interactions-list"></div>
                    </div>
                </div>
            </div>
            <div class="control-section">
                <h2>CEO Agent</h2>
                <div id="ceo-agent" class="system-status">
                    <div class="status-item">
                        <span class="status-label">CEO Status:</span>
                        <span id="ceo-status" class="status-value">Loading...</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Strategic Decisions:</span>
                        <div id="strategic-decisions" class="decisions-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agents Tab -->
        <div id="agents-tab" class="tab-content">
            <div class="control-section">
                <h2>Agent Management</h2>
                <div class="agent-controls">
                    <button id="refresh-agents-btn">Refresh Agents</button>
                    <button id="create-agent-btn">Create Agent</button>
                    <button id="delete-agent-btn" class="delete-btn" disabled>Delete Agent</button>
                </div>
                <div class="agent-tabs">
                    <button class="agent-tab-btn active" data-agent-tab="system">System Agents</button>
                    <button class="agent-tab-btn" data-agent-tab="user">User Agents</button>
                    <button class="agent-tab-btn" data-agent-tab="all">All Agents</button>
                </div>
                <div id="agents-list" class="agents-list"></div>
            </div>
            
            <!-- AGIVITY - Executive Dashboard -->
            <div class="control-section">
                <div class="section-header">
                    <h2>AGIVITY</h2>
                    <div class="activity-controls">
                        <button id="pause-activity" class="control-btn">Pause</button>
                        <button id="clear-activity" class="control-btn">Clear</button>
                        <button id="refresh-metrics" class="control-btn">Refresh</button>
                        <button id="test-popup" class="control-btn" onclick="showAgentDetailPopup('bdi', 'BDI Agent')">Test Popup</button>
                    </div>
                </div>
                
                <!-- Executive Metrics Overview -->
                <div class="metrics-overview">
                    <div class="metric-card">
                        <div class="metric-icon">🧠</div>
                        <div class="metric-content">
                            <div class="metric-value" id="active-agents">0</div>
                            <div class="metric-label">Active Agents</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-icon">⚡</div>
                        <div class="metric-content">
                            <div class="metric-value" id="tasks-completed">0</div>
                            <div class="metric-label">Tasks Completed</div>
                        </div>
                    </div>
                </div>

                <!-- Agent Status Grid -->
                <div class="agent-status-grid">
                    <div class="agent-status-card" id="bdi-status">
                        <div class="agent-header">
                            <div class="agent-name">BDI Agent</div>
                            <div class="agent-status-indicator" id="bdi-indicator"></div>
                        </div>
                        <div class="agent-activity" id="bdi-activity">Standby</div>
                        <div class="agent-metrics">
                            <span class="metric">Decisions: <span id="bdi-decisions">0</span></span>
                            <span class="metric">Success: <span id="bdi-success">0%</span></span>
                        </div>
                    </div>
                    
                    <div class="agent-status-card" id="agint-status">
                        <div class="agent-header">
                            <div class="agent-name">AGInt Core</div>
                            <div class="agent-status-indicator" id="agint-indicator"></div>
                        </div>
                        <div class="agent-activity" id="agint-activity">Idle</div>
                        <div class="agent-metrics">
                            <span class="metric">Cycles: <span id="agint-cycles">0</span></span>
                            <span class="metric">Progress: <span id="agint-progress">0%</span></span>
                        </div>
                    </div>
                    
                    <div class="agent-status-card" id="simple-coder-status">
                        <div class="agent-header">
                            <div class="agent-name">Simple Coder</div>
                            <div class="agent-status-indicator" id="simple-coder-indicator"></div>
                        </div>
                        <div class="agent-activity" id="simple-coder-activity">Ready</div>
                        <div class="agent-metrics">
                            <span class="metric">Requests: <span id="simple-coder-requests">0</span></span>
                            <span class="metric">Approved: <span id="simple-coder-approved">0</span></span>
                        </div>
                    </div>
                    
                    <div class="agent-status-card" id="coordinator-status">
                        <div class="agent-header">
                            <div class="agent-name">Coordinator</div>
                            <div class="agent-status-indicator" id="coordinator-indicator"></div>
                        </div>
                        <div class="agent-activity" id="coordinator-activity">Monitoring</div>
                        <div class="agent-metrics">
                            <span class="metric">Delegations: <span id="coordinator-delegations">0</span></span>
                            <span class="metric">Active: <span id="coordinator-active">0</span></span>
                        </div>
                    </div>
                    
                    <div class="agent-status-card" id="mastermind-status">
                        <div class="agent-header">
                            <div class="agent-name">MastermindAgent</div>
                            <div class="agent-status-indicator" id="mastermind-indicator"></div>
                        </div>
                        <div class="agent-activity" id="mastermind-activity">Orchestrating</div>
                        <div class="agent-metrics">
                            <span class="metric">Strategies: <span id="mastermind-strategies">0</span></span>
                            <span class="metric">Active: <span id="mastermind-active">0</span></span>
                        </div>
                    </div>
                    
                    <div class="agent-status-card" id="resource-monitor-status">
                        <div class="agent-header">
                            <div class="agent-name">Resource Monitor</div>
                            <div class="agent-status-indicator" id="resource-monitor-indicator"></div>
                        </div>
                        <div class="agent-activity" id="resource-monitor-activity">Monitoring</div>
                        <div class="agent-metrics">
                            <span class="metric">CPU: <span id="resource-monitor-cpu">0%</span></span>
                            <span class="metric">Memory: <span id="resource-monitor-memory">0%</span></span>
                        </div>
                    </div>
                </div>

                <!-- Workflow Visualization -->
                <div class="workflow-visualization">
                    <div class="workflow-header">
                        <h3>Agent Workflow</h3>
                        <div class="workflow-controls">
                            <button id="refresh-workflow" class="workflow-btn">Refresh</button>
                        </div>
                    </div>
                    <div class="workflow-diagram">
                        <div class="workflow-node mastermind">
                            <div class="node-icon">🧠</div>
                            <div class="node-name">MastermindAgent</div>
                            <div class="node-status" id="mastermind-workflow-status">Active</div>
                        </div>
                        <div class="workflow-arrow">→</div>
                        <div class="workflow-node coordinator">
                            <div class="node-icon">🎯</div>
                            <div class="node-name">Coordinator</div>
                            <div class="node-status" id="coordinator-workflow-status">Active</div>
                        </div>
                        <div class="workflow-arrow">→</div>
                        <div class="workflow-node agint">
                            <div class="node-icon">🔄</div>
                            <div class="node-name">AGInt Core</div>
                            <div class="node-status" id="agint-workflow-status">Processing</div>
                        </div>
                        <div class="workflow-arrow">→</div>
                        <div class="workflow-node bdi">
                            <div class="node-icon">⚡</div>
                            <div class="node-name">BDI Agent</div>
                            <div class="node-status" id="bdi-workflow-status">Deciding</div>
                        </div>
                        <div class="workflow-arrow">→</div>
                        <div class="workflow-node simple-coder">
                            <div class="node-icon">💻</div>
                            <div class="node-name">Simple Coder</div>
                            <div class="node-status" id="simple-coder-workflow-status">Generating</div>
                        </div>
                    </div>
                    <div class="workflow-legend">
                        <div class="legend-item">
                            <span class="legend-color active"></span>
                            <span>Active</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color processing"></span>
                            <span>Processing</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-color waiting"></span>
                            <span>Waiting</span>
                        </div>
                    </div>
                </div>

                <!-- Activity Display -->
                <div class="activity-summary">
                    <div id="agent-activity-log" class="activity-log-compact"></div>
                </div>
            </div>
        </div>

        <!-- Agent Detail Popup -->
        <div id="agent-detail-popup" class="agent-detail-popup">
            <div class="popup-backdrop" id="popup-backdrop"></div>
            <div class="popup-content">
                <div class="popup-header">
                    <h3 id="popup-agent-name">Agent Details</h3>
                    <button class="popup-close" id="popup-close">&times;</button>
                </div>
                <div class="popup-body">
                    <div class="agent-detail-section">
                        <div class="detail-header">
                            <div class="agent-icon" id="popup-agent-icon">🧠</div>
                            <div class="agent-info">
                                <div class="agent-name" id="popup-agent-title">Agent Name</div>
                                <div class="agent-status" id="popup-agent-status">Status</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="agent-detail-section">
                        <h4>Current Activity</h4>
                        <div class="activity-detail" id="popup-current-activity">No current activity</div>
                    </div>
                    
                    <div class="agent-detail-section">
                        <h4>Metrics</h4>
                        <div class="metrics-grid" id="popup-metrics">
                            <!-- Dynamic metrics will be populated here -->
                        </div>
                    </div>
                    
                    <div class="agent-detail-section">
                        <h4>Recent Activity</h4>
                        <div class="activity-history" id="popup-activity-history">
                            <!-- Recent activities will be populated here -->
                        </div>
                    </div>
                    
                    <div class="agent-detail-section">
                        <h4>Capabilities</h4>
                        <div class="capabilities-list" id="popup-capabilities">
                            <!-- Agent capabilities will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Tab -->
        <div id="system-tab" class="tab-content">
            <div class="control-section">
                <div class="monitoring-header">
                    <h2>System Monitoring</h2>
                </div>

                <!-- Performance Monitoring -->
                <div class="monitoring-section">
                    <div class="section-header">
                        <h3>Performance Monitor</h3>
                        <div class="agent-status" id="performance-agent-status">
                            <span class="status-dot" id="perf-status-indicator"></span>
                            <span id="perf-agent-status">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-item">
                            <div class="metric-label">API Calls</div>
                            <div class="metric-value" id="perf-total-calls">0</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Success Rate</div>
                            <div class="metric-value" id="perf-success-rate">0%</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Avg Latency</div>
                            <div class="metric-value" id="perf-avg-latency">0ms</div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Total Cost</div>
                            <div class="metric-value" id="perf-total-cost">$0.00</div>
                        </div>
                    </div>
                </div>

                <!-- Resource Monitoring -->
                <div class="monitoring-section">
                    <div class="section-header">
                        <h3>Resource Monitor</h3>
                        <div class="agent-status" id="resource-agent-status">
                            <span class="status-dot" id="res-status-indicator"></span>
                            <span id="res-agent-status">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="metrics-row">
                        <div class="metric-item">
                            <div class="metric-label">CPU Usage</div>
                            <div class="metric-value" id="res-cpu-usage">0%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="res-cpu-progress"></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Memory Usage</div>
                            <div class="metric-value" id="res-memory-usage">0%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="res-memory-progress"></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Disk Usage</div>
                            <div class="metric-value" id="res-disk-usage">0%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="res-disk-progress"></div>
                            </div>
                        </div>
                        <div class="metric-item">
                            <div class="metric-label">Alerts</div>
                            <div class="metric-value" id="res-alerts">0</div>
                        </div>
                    </div>
                </div>


                <!-- System Commands -->
                <div class="monitoring-section">
                    <div class="section-header">
                        <h3>System Commands</h3>
                    </div>
                    <div class="button-grid">
                        <button id="status-btn">SYSTEM STATUS</button>
                        <button id="agents-btn">List Agents</button>
                        <button id="tools-btn">List Tools</button>
                        <button id="replicate-btn">Trigger Replication</button>
                    </div>
                </div>

                <!-- API Response -->
                <div class="monitoring-section">
                    <div class="section-header">
                        <h3>API Response</h3>
                    </div>
                    <pre id="response-output">Loading system health check...</pre>
                </div>

            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs-tab" class="tab-content">
            <div class="control-section">
                <div class="logs-header">
                    <h2>System Logs</h2>
                    <button id="copy-logs-btn" class="copy-btn" title="Copy logs to clipboard">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6z"/>
                            <path d="M2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2z"/>
                        </svg>
                    </button>
                </div>
                <div class="log-controls">
                    <button id="refresh-logs-btn">Refresh Logs</button>
                    <button id="clear-logs-btn">Clear Logs</button>
                    <select id="log-level-filter">
                        <option value="all">All Levels</option>
                        <option value="DEBUG">DEBUG</option>
                        <option value="INFO">INFO</option>
                        <option value="WARNING">WARNING</option>
                        <option value="ERROR">ERROR</option>
                        <option value="CRITICAL">CRITICAL</option>
                    </select>
                </div>
                <div id="logs-output" class="logs-output"></div>
            </div>
        </div>


        <!-- Admin Tab -->
        <div id="admin-tab" class="tab-content">
            <div class="control-section">
                <h2>Admin Controls</h2>
                <div class="admin-controls">
                    <button id="restart-system-btn">Restart System</button>
                    <button id="backup-system-btn">Backup System</button>
                    <button id="update-config-btn">Update Config</button>
                    <button id="export-logs-btn">Export Logs</button>
                </div>
            </div>
            <div class="control-section">
                <h2>System Configuration</h2>
                <div id="config-display" class="config-display"></div>
            </div>
        </div>
    </div>

    <!-- Agent Details Popup Modal -->
    <div id="agent-details-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-agent-name">Agent Details</h2>
                <button id="close-agent-modal" class="close-btn" onclick="closeAgentDetailsModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="agent-details-content" class="agent-details-content">
                    <p>Loading agent details...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        window.MINDX_BACKEND_PORT = "8000";
    </script>
    <script src="app.js?v=20250118193130"></script>
</body>
</html>